<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>gravity demo</title>
    <!--Makes a nice title on the tab-->
    <script src="p5/p5.min.js"></script>
    <script src="p5/p5.collide2d.min.js"></script>
    <script src="barrier.js"></script>
    <script src="jumper.js"></script>
    <script src="platform.js"></script>
    <script src="ground.js"></script>
    <!--references the page to the p5 library-->
    <style>
        body {
            overflow: hidden;
            /*keeps scroll bars from appearing*/
            padding: 0;
            /*ensures no gaps appearon page around edges*/
            margin: 0;
            /*ensures no gaps appearon page around edges*/
        }


        /* Style the video: 100% width and height to cover the entire window */
        #myVideo {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            z-index: -1;
        }

        /* Add some content at the bottom of the video/page */
        .content {
            position: fixed;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            color: #f1f1f1;
            width: 100%;
            padding: 20px;
        }

        h1 {
            display: inline;
            color: azure;
            position: fixed;
        }
    </style>
</head>

<body>
    <!-- The video -->
    <video autoplay muted loop id="myVideo">
        <source src="media/space.mp4" type="video/mp4">
    </video>
    <script>
        //we could refer to an external js file but i would like to keep it all on one simple file
        var userSpeed = 8; //sensitivity of movement for player
        var w = window.innerWidth; //defines window size
        var h = window.innerHeight; //defines window sized
        var ground = new ground();
        var ball = new ball(); //global object is created here
        var barrier = new barrier();
        var platform = new platform();
        var r; //Random color values (left blank for definition in the function)
        var g; //Random color values (left blank for definition in the function)
        var b; //Random color values (left blank for definition in the function)
        var ship;
        var sat;
        var rock;
        var ts = 48;
        var hit = false;
        var score = 0;
        var highScoreCombo = 0;
        var video = document.getElementById("myVideo");
        
        function preload() {
            ship = loadImage("media/chicken.png");
            sat = loadImage("media/satellite.png");
            rock = loadImage("media/rock.png");
        }

        function setup() { //runs once at startup
            console.log("sat location " + platform.x + " , " + platform.y);
            console.log("map size " + w + " , " + h);
            createCanvas(w, h); //creates area as big as window
            //background(0); //makes a black background
            ship.loadPixels();
            r = random(256); //random color selection
            g = random(256); //random color selection
            b = random(256); //random color selection
        }

        function draw() { //runs at 60Hz
            clear();
            barrier.show();
            barrier.update();
            ball.update();
            ball.show(); //makes the ball appear by calling the function  in the object
            ball.move();
            platform.show();
            ground.show();

            hit = collideRectCircle(barrier.x, barrier.y, barrier.width, barrier.height, ball.x, ball.y, 50);
            if (hit == true) {
                //noLoop();
                console.log("barrier hit detected!");
                if (barrier.dodgeCount > highScoreCombo) {
                    highScoreCombo = barrier.dodgeCount;
                }
                barrier.dodgeCount = 0;

            }
            hit = collideRectCircle(platform.x, platform.y, platform.width, platform.height, ball.x, ball.y, 5);
            if (hit == true) {
                ball.velocity = -10;
                console.log("platform hit detected!");
                r = random(256); //random color selection
                g = random(256); //random color selection
                b = random(256); //random color selection
                platform.hit++;

            }
            hit = collideRectCircle(ground.x, ground.y, ground.width, ground.height, ball.x, ball.y, 50);
            if (hit == true) {
                ball.velocity = -5;
                console.log("ground hit detected!");


            }
            document.getElementById('coo').innerHTML = "barriers dodged: [" + barrier.dodgeCount + "]" + "bounces: [" +
                platform.hit + "]" + "score: [" + score + "]" + "Time: [" + timer + "]" + "Framerate: [" + Math.floor(
                    frameRate()) + "]";
        }
        var timer = 61;
        var myVar = setInterval(myTimer, 1000);

        function myTimer() {
            if (timer > 0) {
                --timer;
                //document.getElementById("demo").innerHTML = "Time: [" + timer + "]";

            } else {
                clearInterval(myVar);
                localStorage.setItem('barrierCount', highScoreCombo);
                localStorage.setItem('score', score);
                location.href = "GameOver.html";
            }
        }


        function keyPressed() {
            if (keyCode === 32) {
                ball.up();
                console.log("spacebar pressed");
            }
            if (keyCode === 80) {
                if (video.paused) {
                    video.play();
                    console.log("video resumed");
                } else {
                    video.pause();
                    console.log("video paused");
                }
                
            }
        }
    </script>
    <h1 id="coo"></h1>

    <h1 id="demo"></h1>
    <!--made an element to display coordinates-->
    <h1 id="p5_loading">Loading... you really shouldnt be seeing this unless theres a problem with the graphics</h1>
</body>

</html>